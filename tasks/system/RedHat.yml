---
- name: Set logstash version if defined
  set_fact:
    ls_package_name: "{{ ls_package_name }}-{{ ls_version }}"
  when: ls_version.find('.x') == -1

- name: debug
  debug:
    var: ls_package_name

- block:
    - name: Enable EPEL repository
      yum:
        name: https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
        state: present
      register: install_package
      until: install_package is succeeded

    - name: Importing latest Elastic GPG Key
      rpm_key:
        key: "{{ elastic_gpg_key }}"
        state: present
      register: installed_key
      until: installed_key is succeeded

    - name: Add elasticsearch yum repository
      yum_repository:
        name: elasticsearch
        description: Elasticsearch repository
        file: "{{ es_repo_file }}"
        baseurl: "{{ es_yum_url }}"
        gpgcheck: true
        gpgkey: "{{ elastic_gpg_key }}"
        enabled: true
        state: present

    - name: Redhat - Installing Logstash package
      yum:
        name: "{{ ls_package_name }}"
        state: present
        update_cache: true
      register: installed_package
      until: installed_package is succeeded
      environment:
        LS_JAVA_OPTS: "{{ ls_java_opts }}"
  become: true

- name: Checking selinux support
  include_tasks: ../selinux-support.yml
